@page "/createcourse"
@using DogRally.Models
@using HundeProjekt.Models
@using System.Text.Json
@inject HttpClient Http

<h3>Opret Bane</h3>



<!-- Giv hvert dragbart element et unikt ID -->
<div id="drag-1" class="draggable">
    <p> 1 </p>
</div>
<div id="drag-2" class="draggable">
    <p> 2 </p>
</div>

<div id="outer-dropzone" class="dropzone">
    #outer-dropzone
</div>

@inject IJSRuntime JSRuntime

@code {
    private async Task<dynamic> GetPositionFromLocalStorageAsync(string uniqueId)
    {
        // Invoke the JavaScript function and return its value
        return await JSRuntime.InvokeAsync<object>("getPositionFromLocalStorage", uniqueId);
    }
}

@code {
    protected override async Task OnInitializedAsync()
    {
        string uniqueId = "clone-1712574903875-47abcb97b5b258"; // Eksempel på unikt ID

        // Call JS-method to get the positon as a JSON-string
        var positionJson = await GetPositionFromLocalStorageAsync(uniqueId);


        Console.WriteLine($"json string: {positionJson}");

        //Convert json to string
        string JsonString = positionJson.ToString();

        //Deserialize json string
        if (JsonString != null)
        {
            Position position = JsonSerializer.Deserialize<Position>(JsonString);

            if (position != null)
            {
                Console.WriteLine($"position x-værdi: {position.X} position y-værdi: {position.Y}");
            }
        }
    }
}



<EditForm Model="@course" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="CourseName">Banenavn:</label>
        <InputText id="CourseName" class="form-control" @bind-Value="@course.CourseName" />
    </div>
    <div class="form-group">
        <label for="CourseDate">Banedato:</label>
        <InputDate id="CourseDate" class="form-control" @bind-Value="@course.CourseDate" />
    </div>
    @* <div class="form-group">
    <label for="PositionX">Position X:</label>
    <InputNumber @bind-Value="@positionX" class="form-control" />
    </div>
    <div class="form-group">
    <label for="PositionY">Position Y:</label>
    <InputNumber @bind-Value="@positionY" class="form-control" />
    </div> *@

    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>



@if (showSuccessMessage)
{
    <div class="alert alert-success" role="alert">
        Kursus oprettet succesfuldt!
    </div>
}

@if (showErrorMessage)
{
    <div class="alert alert-danger" role="alert">
        Der opstod en fejl ved oprettelsen af kurset. @errorMessage
    </div>
}

@code {
    private Course course = new Course();
    private bool showSuccessMessage = false;
    private bool showErrorMessage = false;
    private string errorMessage;


    private async Task HandleValidSubmit()
    {
        try
        {
            var response = await Http.PostAsJsonAsync("https://localhost:7261/api/Course/ForwardCourseToMvc", course); //Fuld sti istedet for relativ sti
            response.EnsureSuccessStatusCode(); // Sikrer, at anmodningen var vellykket

            showSuccessMessage = true;
            showErrorMessage = false;
        }
        catch (HttpRequestException ex)
        {
            // Håndter fejlen
            showSuccessMessage = false;
            showErrorMessage = true;
            errorMessage = ex.Message; // Gem den faktiske fejlbesked
        }
    }
}
